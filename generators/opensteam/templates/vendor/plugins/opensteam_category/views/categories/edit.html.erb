<% render_headline 'categories_icon', "Edit Category ##{@category.id}", 'content-header/headline_icon.jpg' %>
<% render_header_buttons 'Save', :form_id => "update_category", :class => 'save-button' %>

<%= error_messages_for :dog_food %>


<div id="editor-wrapper">
  <table cellpadding="0" cellspacing="0">
    <tr>
      <td width="200">
				<div class="dvEditorNaviHeadline">Categories</div>
				<div id="category-tree" style="float:left;width: 200px ;"></div>
      </td>
      <td width="20"><br /></td>
      <td width="100%" id="editor_content">
				<% form_for :category, @category, :url => { :action => :update }, :html => { :id => "update_category", :method => :put } do |f| %>
          <div id="dvEditorTabContainer">
            <div id="general_tab" class="x-hide-display" >
              <%= render :partial => "categories/attributes", :object => f %>
            </div>
            <div id="products_tag" class="x-hide-display" >
              <%= render :partial => "categories/products", :object => @category.products, :locals => { :f => f } %>
            </div>
          </div>
          <div id="dvEditorTabFooter">
            <div id="dvEditorTabFooter-inner">
              <div id="dvEditorTabFooterLeft">&nbsp;</div>
              <div id="dvEditorTabFooterRight">&nbsp;</div><br clear="all" />
            </div>
          </div>
        <% end %>
      </td>
    </tr>
  </table>
</div>


<% javascript_tag do %>
var cb=function(tab){checkTab_setFooterButtons(tab);createLocalGrid('the-table');}

  build_tabs( 'dvEditorTabContainer', [
  { contentEl: 'general_tab', title: 'Attributes', listeners: { activate: checkTab_setFooterButtons },
  button: {
  left: 	{ title: "cancel", url: '<%= admin_catalog_categories_path %>' },
  right: 	{ title: "next", clickEvent: 'tabs.setActiveTab(1); return false;' }
  }
  },
  { contentEl: 'products_tag', title: 'Associated Products', listeners: { activate: cb },
  button: {
  left: 	{ title: "previous", clickEvent: 'tabs.setActiveTab(0); return false; ' },
  right: 	{ title: "save", clickEvent: "$('update_category').submit(); return false;" }
  }
  }

  ] ) ;
<% end %>

<%= render :partial => "/admin/_tree/tree", :locals => { 
  :model => "category", 
  :render_to => "category-tree", 
  :url => '/admin/catalog/categories/',
  :checkable => false,
  :expand_all => true } %>

<script>
    var mytree = configureTree( { 
        url: '/admin/catalog/categories/',
        baseAttrs:{}, 
        renderTo:'category-tree',
        baseParams:{format:'json'}
    }, <%= @categories.to_json %>  ) ;

    Ext.onReady( function() {
        //mytree.expandAll() ;
        mytree.selectPath( '<%= @category.path %>') ;
        mytree.render() ;
				initTreeDD( mytree ) ;
    } ) ;
</script>


